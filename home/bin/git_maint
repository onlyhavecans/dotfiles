#!/usr/bin/env bash

function status_message {
  echo -e "~~ $*"
}

function error_message {
  RED='\033[0;31m'
  NOCOLOR='\033[0m'
  echo -e "${RED}! $*${NOCOLOR}"
}

status_message "git fsck"
if ! git fsck --full --no-progress; then
  error_message "Repo failed FSCK: $PWD"
fi

status_message "git maintenance"
git maintenance run --task gc --task loose-objects --task pack-refs --task incremental-repack

status_message "git gc"
git gc --aggressive --prune=now
